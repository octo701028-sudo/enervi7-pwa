<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enervi7</title>

  <!-- PWA 支援 -->
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#6C4AB6">

  <!-- App Icons -->
  <link rel="icon" href="./icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="./icon-512.png" />

  <!-- Style -->
  <link rel="stylesheet" href="./style.css?v=1">
</head>
<body>
  <div id="app">
    <header>
      <h1>Enervi 7</h1>
      <button id="installBtn" hidden>安裝 App</button>
    </header>

    <main>
      <p>⚡ 填寫 14 題，按「開始測驗」後立即顯示雷達圖、分數與瓶頸摘要。</p>
      <div id="formContainer"></div>
      <div id="resultContainer"></div>
      <div id="historyContainer"></div>
    </main>
  </div>

  <!-- JS 主程式 -->
  <script src="./app.js?v=1"></script>

  <!-- Service Worker 註冊 -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').then(reg => {
          console.log('✅ SW 已註冊:', reg);
        }).catch(err => {
          console.log('❌ SW 註冊失敗:', err);
        });
      });
    }

    // PWA 安裝提示
    let deferredPrompt;
    const installBtn = document.getElementById("installBtn");

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.hidden = false;
    });

    installBtn.addEventListener("click", () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === "accepted") {
            console.log("✅ 使用者安裝了 App");
          } else {
            console.log("❌ 使用者拒絕安裝");
          }
          deferredPrompt = null;
          installBtn.hidden = true;
        });
      }
    });
  </script>
</body>
</html>