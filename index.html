<!doctype html><html lang="zh-Hant"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="manifest" href="manifest.webmanifest"/><meta name="theme-color" content="#6c45d6"/><title>Enervi 7</title>
<link rel="stylesheet" href="style.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head><body>
<header>Enervi 7</header>
<div class="container">
 <div class="progress-wrap"><span class="badge">進度</span><div class="progress"><i id="progressBar"></i></div><span class="small"><span id="progressNum">0</span>/14</span><button id="installBtn" class="btn secondary" style="margin-left:auto">安裝 App</button></div>
 <section class="card"><h2>填寫 14 題</h2><p class="caption">按「開始測驗」後會顯示雷達圖（整合/Q/T）、主導＋瓶頸摘要、精油建議與行動建議，並可下載結果卡。</p></section>
 <section class="card" id="formCard">
  <div class="section-title"><h2>七階題 Q1–Q7</h2><span class="caption">0→10</span></div><div id="qWrap"></div><hr/>
  <div class="section-title"><h2>七個轉換 T1–T7</h2><span class="caption">0→10</span></div><div id="tWrap"></div><hr/>
  <div class="row">
   <label class="badge"><input type="checkbox" id="usePenalty"/> 加強卡關顯示</label>
   <label>τ <input class="kbd" id="tauInput" type="number" step="0.1" min="0" max="10" value="4.0"/></label>
   <label>δ <input class="kbd" id="deltaInput" type="number" step="0.1" min="0" max="2" value="0.3"/></label>
   <button id="submitBtn" class="btn">開始測驗</button>
  </div>
 </section>
 <section class="card" id="resultCard" style="display:none">
  <div class="section-title"><h2>結果</h2><div class="row"><button id="saveLogBtn" class="btn secondary">存到日誌</button><button id="downloadBtn" class="btn">下載結果卡（PNG）</button></div></div>
  <div class="grid-2">
   <div><canvas id="radarCanvas" height="420"></canvas><p class="caption">紫：整合；灰：僅 Q；淡紫：僅 T。</p></div>
   <div><h3 id="summaryTitle">摘要</h3><div id="summaryText" class="caption"></div><h3>推薦精油</h3><div id="oilSuggest"></div><h3>七階分數（0–100）</h3><div id="stageScores"></div><h3>轉換分數（0–100）</h3><div id="transScores"></div></div>
  </div>
 </section>
 <section class="card"><h2>七階關鍵字＋行動建議</h2><div id="stageHelp" class="grid-3"></div></section>
 <section class="card"><h2>能量日誌（本地保存）</h2><textarea id="journal" rows="3" style="width:100%;padding:10px;border-radius:10px;background:#12122a;color:#fff;border:1px solid #2f2f4b" placeholder="今天的重點或感想…"></textarea><div class="row" style="margin-top:10px"><button id="saveJournal" class="btn">保存到日誌</button><span class="caption">保存在 localStorage；不會上傳。</span></div></section>
 <section class="card"><h2>歷史走勢（最近 7 次平均）</h2><canvas id="trendCanvas" height="160"></canvas><div class="caption" id="historyNote"></div></section>
 <footer>© Enervi7 — PWA</footer>
</div>
<script src="app.js"></script>
<script>
if('serviceWorker' in navigator){window.addEventListener('load',()=>{const v=Date.now();navigator.serviceWorker.register('./sw.js?v='+v);});}
let deferredPrompt;const installBtn=document.getElementById('installBtn');window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;installBtn.style.display='block';});installBtn.addEventListener('click',async()=>{if(!deferredPrompt)return;deferredPrompt.prompt();await deferredPrompt.userChoice;deferredPrompt=null;});
</script>
</body></html>
